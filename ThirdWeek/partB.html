<!DOCTYPE html>
<html>
<head>
    <title>System Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>System Simulation</h1>

    <label for="numSystems">Number of Systems (M):</label>
    <input type="number" id="numSystems" value="5"><br><br>

    <label for="numAttacks">Number of Attacks (N):</label>
    <input type="number" id="numAttacks" value="10"><br><br>

    <label for="penetrationProbability">Penetration Probability (p):</label>
    <input type="number" id="penetrationProbability" value="0.2"><br><br>

    <button onclick="simulateSystems()">Simulate</button><br><br>

    <div class="chart-container">
        <canvas id="cumulativeChart"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="relativeChart"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="normalizedChart"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="histogramChart"></canvas>
    </div>

    <script>
        function simulateSystems() {
            const numSystems = parseInt(document.getElementById("numSystems").value);
            const numAttacks = parseInt(document.getElementById("numAttacks").value);
            const penetrationProbability = parseFloat(document.getElementById("penetrationProbability").value);

            const cumulativeCanvas = document.getElementById("cumulativeChart").getContext("2d");
            const relativeCanvas = document.getElementById("relativeChart").getContext("2d");
            const normalizedCanvas = document.getElementById("normalizedChart").getContext("2d");
            const histogramCanvas = document.getElementById("histogramChart").getContext("2d");

            const cumulativeFrequency = simulateCumulativeFrequency(numSystems, numAttacks, penetrationProbability);
            createCumulativeChart(cumulativeCanvas, cumulativeFrequency);
            
            const relativeFrequency = simulateRelativeFrequency(cumulativeFrequency, numAttacks);
            createRelativeChart(relativeCanvas, relativeFrequency);
            
            const normalizedFrequency = simulateNormalizedFrequency(cumulativeFrequency, numAttacks);
            createNormalizedChart(normalizedCanvas, normalizedFrequency);
            
            const histogramData = simulateHistogramData(cumulativeFrequency);
            createHistogramChart(histogramCanvas, histogramData);
        }

        function simulateCumulativeFrequency(numSystems, numAttacks, penetrationProbability) {
            const cumulativeFrequency = new Array(numAttacks).fill(0);

            for (let systemIndex = 0; systemIndex < numSystems; systemIndex++) {
                let f = 0;

                for (let attack = 0; attack < numAttacks; attack++) {
                    if (Math.random() < penetrationProbability) {
                        f++;
                    }

                    cumulativeFrequency[attack] += f;
                }
            }

            return cumulativeFrequency;
        }

        function simulateRelativeFrequency(cumulativeFrequency, numAttacks) {
            return cumulativeFrequency.map(value => value / numAttacks);
        }

        function simulateNormalizedFrequency(cumulativeFrequency, numAttacks) {
            return cumulativeFrequency.map(value => value / Math.sqrt(numAttacks));
        }

        function simulateHistogramData(cumulativeFrequency) {
            return cumulativeFrequency;
        }

        // Funzioni per creare i grafici utilizzando Chart.js
        function createCumulativeChart(ctx, data) {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: data.length }, (_, i) => i + 1),
                    datasets: [{
                        label: 'Cumulative Frequency',
                        data: data,
                        borderColor: 'blue',
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                }
            });
        }

        function createRelativeChart(ctx, data) {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: data.length }, (_, i) => i + 1),
                    datasets: [{
                        label: 'Relative Frequency',
                        data: data,
                        borderColor: 'green',
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                }
            });
        }

        function createNormalizedChart(ctx, data) {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: data.length }, (_, i) => i + 1),
                    datasets: [{
                        label: 'Normalized Ratio',
                        data: data,
                        borderColor: 'red',
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                }
            });
        }

        function createHistogramChart(ctx, data) {
            const barData = {
                labels: Array.from({ length: data.length }, (_, i) => i + 1),
                datasets: [{
                    label: 'Histogram',
                    backgroundColor: 'purple',
                    data: data,
                }]
            };

            new Chart(ctx, {
                type: 'bar',
                data: barData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                        },
                        y: {
                            beginAtZero: true,
                        },
                    },
                }
            });
        }

        // Chiamata iniziale per generare i grafici iniziali
        simulateSystems();
    </script>
</body>
</html>
