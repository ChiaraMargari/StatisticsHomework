<!DOCTYPE html>
<html>
<head>
    <title>System Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>System Simulation</h1>

    <label for="numSystems">Number of Systems (M):</label>
    <input type="number" id="numSystems" value="5"><br><br>

    <label for="numAttacks">Number of Attacks (N):</label>
    <input type="number" id="numAttacks" value="10"><br><br>

    <label for "penetrationProbability">Penetration Probability (p):</label>
    <input type="number" id="penetrationProbability" value="0.2"><br><br>

    <button onclick="simulateSystems()">Simulate</button><br><br>

    <div class="chart-container">
        <canvas id="cumulativeChart"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="relativeChart"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="normalizedChart"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="histogramChart"></canvas>
    </div>

    <script>
        // Variabili globali per mantenere le istanze dei grafici
        let cumulativeChart, relativeChart, normalizedChart, histogramChart;

        function simulateSystems() {
            // Ottieni i nuovi dati
            const numSystems = parseInt(document.getElementById("numSystems").value);
            const numAttacks = parseInt(document.getElementById("numAttacks").value);
            const penetrationProbability = parseFloat(document.getElementById("penetrationProbability").value);

            // Elimina i grafici esistenti se presenti
            if (cumulativeChart) {
                cumulativeChart.destroy();
            }
            if (relativeChart) {
                relativeChart.destroy();
            }
            if (normalizedChart) {
                normalizedChart.destroy();
            }
            if (histogramChart) {
                histogramChart.destroy();
            }

            // Simula i dati
            const cumulativeFrequency = simulateCumulativeFrequency(numSystems, numAttacks, penetrationProbability);
            const relativeFrequency = simulateRelativeFrequency(cumulativeFrequency, numAttacks);
            const normalizedFrequency = simulateNormalizedFrequency(cumulativeFrequency, numAttacks);
            const histogramData = simulateHistogramData(cumulativeFrequency);

            // Crea e mostra i nuovi grafici
            cumulativeChart = createCumulativeChart("cumulativeChart", cumulativeFrequency);
            relativeChart = createRelativeChart("relativeChart", relativeFrequency);
            normalizedChart = createNormalizedChart("normalizedChart", normalizedFrequency);
            histogramChart = createHistogramChart("histogramChart", histogramData);
        }

        function simulateCumulativeFrequency(numSystems, numAttacks, penetrationProbability) {
            const cumulativeFrequency = new Array(numAttacks).fill(0);

            for (let systemIndex = 0; systemIndex < numSystems; systemIndex++) {
                let f = 0;

                for (let attack = 0; attack < numAttacks; attack++) {
                    if (Math.random() < penetrationProbability) {
                        f++;
                    }

                    cumulativeFrequency[attack] += f;
                }
            }

            return cumulativeFrequency;
        }

        function simulateRelativeFrequency(cumulativeFrequency, numAttacks) {
            return cumulativeFrequency.map(value => value / numAttacks);
        }

        function simulateNormalizedFrequency(cumulativeFrequency, numAttacks) {
            return cumulativeFrequency.map(value => value / Math.sqrt(numAttacks));
        }

        function simulateHistogramData(cumulativeFrequency) {
            return cumulativeFrequency;
        }

        // Funzioni per creare i grafici utilizzando Chart.js
        function createCumulativeChart(chartId, data) {
            var ctx = document.getElementById(chartId).getContext('2d');
            cumulativeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: data.length }, (_, i) => i + 1),
                    datasets: [{
                        label: 'Cumulative Frequency',
                        data: data,
                        borderColor: 'blue',
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                }
            });

            return cumulativeChart;
        }

        function createRelativeChart(chartId, data) {
            var ctx = document.getElementById(chartId).getContext('2d');
            relativeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: data.length }, (_, i) => i + 1),
                    datasets: [{
                        label: 'Relative Frequency',
                        data: data,
                        borderColor: 'green',
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                }
            });

            return relativeChart;
        }

        function createNormalizedChart(chartId, data) {
            var ctx = document.getElementById(chartId).getContext('2d');
            normalizedChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: data.length }, (_, i) => i + 1),
                    datasets: [{
                        label: 'Normalized Ratio',
                        data: data,
                        borderColor: 'red',
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                }
            });

            return normalizedChart;
        }

        function createHistogramChart(chartId, data) {
            var ctx = document.getElementById(chartId).getContext('2d');
            const barData = {
                labels: Array.from({ length: data.length }, (_, i) => i + 1),
                datasets: [{
                    label: 'Histogram',
                    backgroundColor: 'purple',
                    data: data,
                }]
            };

            histogramChart = new Chart(ctx, {
                type: 'bar',
                data: barData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                        },
                        y: {
                            beginAtZero: true,
                        },
                    },
                }
            });

            return histogramChart;
        }
    </script>
</body>
</html>
